{% extends "_base_core.html" %}
{% load humanize %}
{% load static %}

{% block page_title %}Errors scattering{% endblock %}
{% block subtitle %}Errors scattering <font size=-1>{{ viewParams.selection|safe }}</font> {% endblock %}
{% block body %}

		<link rel="stylesheet" type="text/css" href="{% static '/css/wizardstyles.css'%}" />

{% if requestParams.reqid %}<br><b>Request ID: {{ requestParams.reqid }}</b> {% endif %}
{% if requestParams.region %}<br><b>Region: {{ requestParams.region }}</b> {% endif %}

{% if grouping|length == 0 %}
<div class="table-scroll">
    <table class="matrix unstriped">
        <tr>
            <th>Task ID <a class="graylink" href="{% url 'errorsScatteringDetailed' 'ALL' reqid %}"><i class="fi-minus"></i></a><br>
                <a class="graylink" href="{% url 'errorsScatteringDetailed' cloud 'ALL' %}"><i class="fi-minus"></i></a>
            </th>
            {% for computingSite in computingSites %}
                <th class="vertical"><div class="vertical"><a class="blacklink bold" href="{% url 'siteInfo' %}{{ computingSite }}/">{{ computingSite }}</a></div></th>
            {% endfor %}
        </tr>

        {% for values in taskserrors %}
            <tr>
              <th><a class="blacklink bold" href="{% url 'taskInfo' values.jeditaskid %}">{{ values.jeditaskid }}</a></th>

            {% for computingSite in computingSites %}
                {% for columnName, stats in values.columns.items %}
                    {% if computingSite == columnName %}
                        <td {% if stats.allc > 10 %}
                                {% if stats.percent < 50 %}class="sm_alarm_fill"
                                {% else %}
                                    {% if stats.percent < 80 %}class="sm_warning_fill"
                                    {% else %}class="sm_ok_fill"{% endif %}
                                {% endif %}
                            {% elif stats.allc > 0 and stats.allc <= 10 %}
                                {% if stats.percent < 50 %}class="sm_alarm_light_fill"
                                {% else %}
                                    {% if stats.percent < 80 %}class="sm_warning_light_fill"
                                    {% else %}class="sm_ok_light_fill"{% endif %}
                                {% endif %}
                            {% endif %}>
                        {% if stats.allc != 0 %}
                          <a href="{% url 'jobList' %}?jobtype=production&jobstatus=finished|failed&jeditaskid={{ values.jeditaskid }}&computingsite={{ computingSite }}&days=30" class="blacklink">
                            {{ stats.percent }}%<br>
                            {{ stats.finishedc }}<br>
                            {{ stats.failedc }}
                          </a>
                        {% endif %}
                        </td>
                    {% endif %}
                {% endfor %}
            {% endfor %}


            </tr>
         {% endfor %}
    </table>
</div>
{% elif 'reqid' in grouping %}

<div class="row align-center" style="width: 100%; max-width: 68rem">
  <div class="column small-12 small-centered">
    <table id="errorsscat" class="unstriped">
        <tr>
            <th>Task ID<br>
                <a class="graylink" href="{% url 'errorsScattering' %}"><i class="fi-minus"></i></a>
            </th>
                {% for c in clouds %}
                     <th>
                         {{ c }} <br>
                         <a class="graylink" href="{% url 'errorsScatteringDetailed' cloud=c|safe reqid=reqid %}"><i class="fi-plus"></i></a>
                     </th>
                {% endfor %}
        </tr>

        {% for values in taskserrors%}
            <tr>
              <th><a class="blacklink bold" href="{% url 'taskInfo' %}?jeditaskid={{ values.jeditaskid }}">{{ values.jeditaskid }}</a></th>
              {% for c in clouds %}
                {% for columnName, stats in values.columns.items %}
                    {% if c == columnName %}
                        <td {% if stats.allc > 10 %}
                                {% if stats.percent < 50 %}class="sm_alarm_fill"
                                {% else %}
                                    {% if stats.percent < 80 %}class="sm_warning_fill"
                                    {% else %}class="sm_ok_fill"{% endif %}
                                {% endif %}
                            {% elif stats.allc > 0 and stats.allc <= 10 %}
                                {% if stats.percent < 50 %}class="sm_alarm_light_fill"
                                {% else %}
                                    {% if stats.percent < 80 %}class="sm_warning_light_fill"
                                    {% else %}class="sm_ok_light_fill"{% endif %}
                                {% endif %}
                            {% endif %}>
                        {% if stats.allc != 0 %}
                          <a href="{% url 'jobList' %}?jobtype=production&jobstatus=finished|failed&jeditaskid={{ values.jeditaskid }}&region={{ c }}&days=30" class="blacklink">
                            {{ stats.percent }}%<br>
                            {{ stats.finishedc }}<br>
                            {{ stats.failedc }}
                          </a>
                        {% endif %}
                        </td>
                    {% endif %}
                 {% endfor %}
              {% endfor %}
            </tr>
         {% endfor %}



    </table>
  </div>
</div>

{% elif 'cloud' in grouping %}

<div class="table-scroll">
    <table class="matrix unstriped">
        <tr>
            <th>Request ID <a class="graylink" href="{% url 'errorsScattering' %}"><i class="fi-minus"></i></a>
            </th>
            {% for computingSite in computingSites %}
               <th class="vertical"><div class="vertical"><a class="blacklink bold" href="{% url 'siteInfo' %}{{ computingSite }}/">{{ computingSite }}</a></div></th>
            {% endfor %}
        </tr>

        {% for values in reqerrors %}
            <tr>
              <th><a class="graylink" href="{% url 'errorsScatteringDetailed' cloud=cloud|safe reqid=values.reqid %}"><i class="fi-plus"></i></a>
                  <a class="blacklink bold" href="{% url 'taskList' %}?reqid={{ values.reqid  }}">{{ values.reqid  }}</a></th>
              {% for computingSite in computingSites %}
                {% for columnName, stats in values.columns.items %}
                    {% if computingSite == columnName %}
                        <td {% if stats.allc > 10 %}
                                {% if stats.percent < 50 %}class="sm_alarm_fill"
                                {% else %}
                                    {% if stats.percent < 80 %}class="sm_warning_fill"
                                    {% else %}class="sm_ok_fill"{% endif %}
                                {% endif %}
                            {% elif stats.allc > 0 and stats.allc <= 10 %}
                                {% if stats.percent < 50 %}class="sm_alarm_light_fill"
                                {% else %}
                                    {% if stats.percent < 80 %}class="sm_warning_light_fill"
                                    {% else %}class="sm_ok_light_fill"{% endif %}
                                {% endif %}
                            {% endif %}>
                        {% if stats.allc != 0 %}
                          <a href="{% url 'jobList' %}?jobtype=production&jobstatus=finished|failed&reqid={{ values.reqid }}&computingsite={{ computingSite }}&days=10" class="blacklink">
                            {{ stats.percent }}%<br>
                            {{ stats.finishedc }}<br>
                            {{ stats.failedc }}
                          </a>
                        {% endif %}
                        </td>
                    {% endif %}
                {% endfor %}
              {% endfor %}
            </tr>
         {% endfor %}
    </table>
</div>
{% endif %}

{% endblock %}
