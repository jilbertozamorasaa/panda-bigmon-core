{% extends "_base_core.html" %}

{% load staticfiles %}
{% load humanize %}

{% block page_title %} {{ viewParams.MON_VO }} Global Shares{% endblock %}
{% block subtitle %}Global Shares{% endblock %}

{% block body %}

  <link rel="stylesheet" type="text/css" href="/static/js/datatables/datatables.min.css"/>
  <script type="text/javascript" src="/static/js/datatables/datatables.min.js"></script>
  <script type="text/javascript" src="/static/js/datatables/dataTables.rowsGroup.js"></script>


  <div class="d3splot" id="pieChartGS"></div>

<table>
    <tr class='tablesection'>
        <th>L1 Share</th>
        <th>L2 Share</th>
        <th>L3 Share</th>
        <th>Actual HS06</th>
        <th>Target HS06</th>
        <th>Ratio</th>
        <th>Used  share</th>
        <th>Queued</th>
    </tr>
    {% for row in tablerows %}
            <tr>
                <td>{{row.level1}}</td>
                <td>{{row.level2}}</td>
                <td>{{row.level3}}</td>
                <td style="text-align:right">{% if row.executing %}{{ row.executing|floatformat:2|intcomma }} {% else %} 0.00 {% endif %}</td>
                <td style="text-align:right">{% if row.pledged %}{{ row.pledged|floatformat:2|intcomma }} {% else %} 0.00 {% endif %}</td>
                <td style="text-align:right">{% if row.ratio %} {{ row.ratio |floatformat:2|intcomma }} % {% else %} --- {% endif %}</td>
                <td style="text-align:right">{% if row.used %} {{ row.used |floatformat:2|intcomma }} % {% else %} --- {% endif %}</td>
                <td style="text-align:right">{% if row.queued %}{{ row.queued|floatformat:2|intcomma }} {% else %} 0.00 {% endif %}</td>
            </tr>
    {% endfor %}
</table>
    <br>

<script>
    $(document).ready(function () {
        DisplayDetailedInformation();
        DisplaySharesDistribution();
        DisplaySiteworkqueues();
        $("#detailedinformation_wrapper").css("width","1030px");
        $("#sharesdistribution_wrapper").css("width","1030px");
        $("#siteworkqueues_wrapper").css("width","1030px");
    });
    function ReverseDisplay(d,hlink) {
        if(document.getElementById(d).style.display == "none") { document.getElementById(d).style.display = "block";
        var urlname = document.getElementById(hlink).innerText;
        urlname = urlname.replace("Show","Hide");
         document.getElementById(hlink).innerText=urlname;
        }
    else { document.getElementById(d).style.display = "none";
        var urlname = document.getElementById(hlink).innerText;
        urlname = urlname.replace("Hide","Show");
        document.getElementById(hlink).innerText=urlname;
        }
    }
    function DisplayDetailedInformation() {
     var detinf = $('#detailedinformation').dataTable({
        //"bRetrieve": true,
        "sPaginationType": "full_numbers",
        paging: true,
        //"bProcessing": true,
        //"bAutoWidth": false,
        //"bStateSave": true,
        "aaSorting": [[0, 'asc']],
                     "ajax": {
                 "processing": true,
                 "url": "{% url 'globalsharesNewV1JSON' %}",

                 "dataSrc" : ''},
         rowsGroup: [0,1],
          "createdRow": function ( row, data, index ) {
            if ( data["jobstatus"] == 'running') {
                $('td', row).eq(2).addClass('running_fill');
                $('td', row).eq(3).addClass('running_fill');
                $('td', row).eq(4).addClass('running_fill');
            }},
        "aoColumns": [
            {
                "data": "gshare",
                sDefaultContent: ""
            },
            {
                "data": "corecount",
                sDefaultContent: "",
            },
            {
                "data": "jobstatus",
                sDefaultContent: "",
            },
            {
                "data": "count",
                sDefaultContent: "",
            },
            {
                "data": "hs06",
                sDefaultContent: "",
            }
        ],
      initComplete: function () {
            this.api().columns([0,1,2]).every( function () {
                var column = this;
                var select = $('<select><option value="">Show all</option></select>')
                    .appendTo( $(column.footer()).empty() )
                    .on( 'change', function () {
                        var val = $.fn.dataTable.util.escapeRegex(
                            $(this).val()
                        );

                        column
                            .search( val ? '^'+val+'$' : '', true, false )
                            .draw();
                    } );

                column.data().unique().sort().each( function ( d, j ) {
                    select.append( '<option value="'+d+'">'+d+'</option>' )
                } );
                column.cells('', column[1]).render('display').sort().unique().each( function ( d, j ){
                    select.append( '<option value="'+d+'">'+d+'</option>' )
                });
            } );

        }
    });

}
    function DisplaySharesDistribution() {
     $('#sharesdistribution').dataTable({
        //"bRetrieve": true,
        "sPaginationType": "full_numbers",
        paging: true,
        //"bProcessing": true,
        //"bAutoWidth": false,
        //"bStateSave": true,
        "aaSorting": [[0, 'asc']],
                     "ajax": {
                 "processing": true,
                 "url": "{% url 'globalsharesNewV2JSON' %}",

                 "dataSrc" : ''},
         rowsGroup: [0,1],
        "aoColumns": [
            {
                "data": "gshare",
                sDefaultContent: ""
            },
            {
                "data": "computingsite",
                sDefaultContent: "",
            },
            {
                "data": "corecount",

                sDefaultContent: "",
            },
            {
                "data": "jobstatus",
                sDefaultContent: "",
            },
            {
                "data": "count",
                sDefaultContent: "",
            }
        ],
         "createdRow": function ( row, data, index ) {
             if ( data["jobstatus"] == 'running') {
                $('td', row).eq(2).addClass('running_fill');
                $('td', row).eq(3).addClass('running_fill');
                $('td', row).eq(4).addClass('running_fill');
            }},
      initComplete: function () {
            this.api().columns([0,1,2,3]).every( function () {
                var column = this;
                var select = $('<select><option value="">Show all</option></select>')
                    .appendTo( $(column.footer()).empty() )
                    .on( 'change', function () {
                        var val = $.fn.dataTable.util.escapeRegex(
                            $(this).val()
                        );

                        column
                            .search( val ? '^'+val+'$' : '', true, false )
                            .draw();
                    } );

                column.data().unique().sort().each( function ( d, j ) {
                    select.append( '<option value="'+d+'">'+d+'</option>' )
                } );
                column.cells('', column[1]).render('display').sort().unique().each( function ( d, j ){
                    select.append( '<option value="'+d+'">'+d+'</option>' )
                });
            } );
        }
    });

}
    function DisplaySiteworkqueues() {
    $('#siteworkqueues').dataTable({
        //"bRetrieve": true,
        "sPaginationType": "full_numbers",
        paging: true,
        //"bProcessing": true,
        //"bAutoWidth": false,
        //"bStateSave": true,
        "aaSorting": [[0, 'asc']],
                     "ajax": {
                 "processing": true,
                 "url": "{% url 'globalsharesNewV3JSON' %}",

                 "dataSrc" : ''},
         rowsGroup: [0,1],
        "aoColumns": [
                   {
                "data": "computingsite",
                sDefaultContent: "",
            },
            {
                "data": "gshare",
                sDefaultContent: ""
            },
            {
                "data": "corecount",
                sDefaultContent: "",

            },
            {
                "data": "jobstatus",
                sDefaultContent: "",
            },
            {
                "data": "count",
                sDefaultContent: "",
            }
        ],
        "createdRow": function ( row, data, index ) {
            if ( data["jobstatus"] == 'running') {
                $('td', row).eq(2).addClass('running_fill');
                $('td', row).eq(3).addClass('running_fill');
                $('td', row).eq(4).addClass('running_fill');
            }},

      initComplete: function () {
            this.api().columns([0,1,2,3]).every( function () {
                var column = this;
                var select = $('<select><option value="">Show all</option></select>')
                    .appendTo( $(column.footer()).empty() )
                    .on( 'change', function () {
                        var val = $.fn.dataTable.util.escapeRegex(
                            $(this).val()
                        );

                        column
                            .search( val ? '^'+val+'$' : '', true, false )
                            .draw();
                    } );

                column.data().unique().sort().each( function ( d, j ) {
                    select.append( '<option value="'+d+'">'+d+'</option>' )
                } );
                column.cells('', column[1]).render('display').sort().unique().each( function ( d, j ){
                    select.append( '<option value="'+d+'">'+d+'</option>' )
                });
            } );
        }
    });
}

         </script>
  <a href="javascript:ReverseDisplay('sharesdistributiondiv','sharesdistributionlink')" id ="sharesdistributionlink">Show shares distribution</a> <br/><br/>
  <div id="sharesdistributiondiv"  style="display: none">
  <hr/>
      <table id="sharesdistribution" style="width: 100%">
          <caption  style="height: 30px;vertical-align: middle">Shares distribution</caption>
     <thead>
                <th>Global share</th>
                <th>Computing site</th>
                <th>Core count</th>
                <th>Job status</th>
                <th>COUNT</th>
     </thead>
     <tbody></tbody>
                <tfoot>
					<tr>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
					</tr>
				</tfoot>
    </table>
  <hr/>
  </div>
   <a href="javascript:ReverseDisplay('siteworkqueuesdiv','siteworkqueueslink')" id ="siteworkqueueslink">Show site workqueues occupations</a>  <br/><br/>
  <div id="siteworkqueuesdiv"  style="display: none">
  <hr/>
      <table id="siteworkqueues" style="width: 100%">
          <caption  style="height: 30px;vertical-align: middle">Site workqueues occupations</caption>
     <thead>
                <th>Computing site</th>
                <th>Global share</th>
                <th>Core count</th>
                <th>Job status</th>
                <th>COUNT</th>
     </thead>
     <tbody></tbody>
      <tfoot>
      <tr>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
	  </tr>
      </tfoot>
    </table>
  <hr/>
   </div>
   <a href="javascript:ReverseDisplay('detailedinformationdiv','detailedinformationlink')" id ="detailedinformationlink">Show detailed information</a> <br/><br/>

  <div id="detailedinformationdiv" style="display: none">
  <hr/>
      <table id="detailedinformation" style="width: 100%">
          <caption  style="height: 30px;vertical-align: middle">Detailed information</caption>
     <thead>
                <th>Global share</th>
                <th>Core count</th>
                <th>Job status</th>
                <th>COUNT</th>
                <th>HS06</th>
     </thead>
     <tbody></tbody>
      			<tfoot>
					<tr>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
					</tr>
				</tfoot>
    </table>
  <hr/>
  </div>



<script src="/static/js/d3jsplot.js"></script>
<script>

var gsPlotData={{ gsPlotData|safe }};
globalSharesPieChartFunc(gsPlotData,"#pieChartGS",'Actual HS06');
$(document).ready(function () {

        $( ".has-dropdown" ).addClass("has-dropdown not-click");
    });
</script>


{% endblock %}

